generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  username  String   @unique
  password  String
  role      String   @default("admin")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Location {
  id          String    @id @default(uuid())
  name        String
  address     String?
  city        String?
  state       String?
  country     String?
  zipCode     String?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  branches    Branch[]
}

model Branch {
  id           String       @id @default(uuid())
  name         String
  code         String       @unique
  locationId   String?
  location     Location?    @relation(fields: [locationId], references: [id])
  isActive     Boolean      @default(true)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  employees    Employee[]
  departments  Department[]
}

model Department {
  id          String     @id @default(uuid())
  name        String
  code        String
  branchId    String?
  branch      Branch?    @relation(fields: [branchId], references: [id])
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  employees   Employee[]

  @@unique([code, branchId])
}

model Designation {
  id          String     @id @default(uuid())
  name        String
  code        String     @unique
  description String?
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  employees   Employee[]
}

model Category {
  id          String     @id @default(uuid())
  name        String
  code        String     @unique
  description String?
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  employees   Employee[]
}

model Employee {
  id              String           @id @default(uuid())
  employeeCode    String           @unique
  firstName       String
  lastName        String
  email           String?
  phone           String?
  branchId        String?
  branch          Branch?          @relation(fields: [branchId], references: [id])
  departmentId    String?
  department      Department?      @relation(fields: [departmentId], references: [id])
  designationId   String?
  designation     Designation?     @relation(fields: [designationId], references: [id])
  categoryId      String?
  category        Category?        @relation(fields: [categoryId], references: [id])
  shiftId         String?
  shift           Shift?           @relation(fields: [shiftId], references: [id])
  deviceUserId    String?
  sourceEmployeeId String?          @unique
  dateOfJoining   DateTime?
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  attendanceLogs  AttendanceLog[]
  leaveEntries    LeaveEntry[]
  employeeShifts  EmployeeShift[]
}

model Shift {
  id              String           @id @default(uuid())
  name            String
  startTime       String
  endTime         String
  gracePeriodIn   Int              @default(0)
  gracePeriodOut  Int              @default(0)
  isNightShift    Boolean          @default(false)
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  employees       Employee[]
  employeeShifts  EmployeeShift[]
}

model EmployeeShift {
  id          String    @id @default(uuid())
  employeeId  String
  employee    Employee  @relation(fields: [employeeId], references: [id])
  shiftId     String
  shift       Shift     @relation(fields: [shiftId], references: [id])
  startDate   DateTime
  endDate     DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Holiday {
  id          String   @id @default(uuid())
  name        String
  date        DateTime
  description String?
  isRecurring Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model LeaveType {
  id           String       @id @default(uuid())
  name         String
  code         String       @unique
  description  String?
  isPaid       Boolean      @default(true)
  isActive     Boolean      @default(true)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  leaveEntries LeaveEntry[]
}

model LeaveEntry {
  id          String    @id @default(uuid())
  employeeId  String
  employee    Employee  @relation(fields: [employeeId], references: [id])
  leaveTypeId String
  leaveType   LeaveType @relation(fields: [leaveTypeId], references: [id])
  startDate   DateTime
  endDate     DateTime
  days        Float
  reason      String?
  status      String    @default("approved")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Device {
  id              String         @id @default(uuid())
  deviceId        String         @unique
  name            String
  ipAddress       String?
  port            Int?
  location        String?
  status          String         @default("offline")
  lastConnected   DateTime?
  isActive        Boolean        @default(true)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  deviceUsers     DeviceUser[]
  rawDeviceLogs   RawDeviceLog[]
}

model DeviceUser {
  id          String   @id @default(uuid())
  deviceId    String
  device      Device   @relation(fields: [deviceId], references: [id])
  deviceUserId String
  employeeId  String?
  name        String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([deviceId, deviceUserId])
}

model RawDeviceLog {
  id          String   @id @default(uuid())
  deviceId    String
  device      Device   @relation(fields: [deviceId], references: [id])
  userId      String
  punchTime   DateTime
  punchType   String?
  isProcessed Boolean  @default(false)
  createdAt   DateTime @default(now())

  @@index([punchTime])
  @@index([userId, punchTime])
  @@index([isProcessed])
}

model AttendanceLog {
  id              String    @id @default(uuid())
  employeeId      String
  employee        Employee  @relation(fields: [employeeId], references: [id])
  date            DateTime
  firstIn         DateTime?
  lastOut         DateTime?
  workingHours    Float?
  shiftStart      DateTime?
  shiftEnd        DateTime?
  lateArrival     Int       @default(0)
  earlyDeparture  Int       @default(0)
  status          String    @default("present")
  totalPunches    Int       @default(0)
  rawData         String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@unique([employeeId, date])
  @@index([date])
  @@index([employeeId])
}

model SyncStatus {
  id            String   @id @default(uuid())
  lastSyncTime  DateTime
  recordsSynced Int      @default(0)
  status        String
  message       String?
  createdAt     DateTime @default(now())
}

model AuditLog {
  id          String   @id @default(uuid())
  userId      String?
  action      String
  entityType  String
  entityId    String?
  oldValue    String?
  newValue    String?
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())

  @@index([createdAt])
}
